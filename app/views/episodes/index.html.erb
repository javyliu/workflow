<div class="panel">
  <h4>提交申请</h4>

  <% Holiday.where(id: current_user.dept_group.second).each do |item|  %>
  <%= link_to "申请#{item.name}", new_episode_path(item.id),class: "button medium" %>
  <% end %>

</div>

<% if @episodes.present? %>
  <h4>已申请</h4>
<table>
  <thead>
    <tr>
      <th>类别</th>
      <th>开始时间</th>
      <th>结束时间</th>
      <th>申请时长</th>
      <th>事由</th>
      <th>审批结果</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  <% @episodes.each do |episode| %>
  <tr>
    <td><%= episode.holiday.name %></td>
    <td><%= episode.start_date %></td>
    <td><%= episode.end_date %></td>
    <td><%= episode.total_time %><%= episode.holiday.unit %></td>
    <td><%= episode.comment %></td>
    <td><%= episode.state %></td>
    <td><%= link_to('详情', episode_path(episode,format: :js),data:{"reveal-id": "modal_window","reveal-ajax": true})%> &nbsp;
      <%= link_to('编辑', edit_episode_path(episode)) if episode.object.state == 0 %>
      <%= link_to('删除', episode_path(episode),data: {remote: true,method: :delete,type: :json}) if can?(:destroy,episode.object) %>
    </td>
  </tr>
  <% end %>
  <tr> <td colspan=7> <%= paginate @episodes %> </td>
  </tr>
  </tbody>
</table>
<% end %>

<div id="modal_window" class="reveal-modal small" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
  <p>loading...</p>
  <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>
